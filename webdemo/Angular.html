<!DOCTYPE html>
<html ng-app="ptcApp">
<head>
    <title></title>
    <meta charset="utf-8" />
    <link href="Content/bootstrap.min.css" rel="stylesheet" />
    <script src="Scripts/jquery-1.9.1.min.js"></script>
    <script src="Scripts/bootstrap.min.js"></script>
    <script src="Scripts/angular.min.js"></script>
    <script src="Scripts/app.js"></script>
    <!--<script src="Scripts/SessionLogic.js"></script>-->
</head>
<body ng-controller="PTCController">
<div class="container">
    <!-- ** PAGE TITLE AREA ** -->
    <div class="row">
        <div class="col-sm-6">
            <h2>Html WebApi and Angular</h2>
        </div>
    </div>

    <!-- ** BEGIN MESSAGE AREA ** -->
    <div ng-show="uiState.isMessageAreaVisible" class="row">
        <div class="alert alert-danger alert-dismissible" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <ul>
                <li ng-repeat="msg in uiState.messages">
                    {{msg.message}}
                </li>
            </ul>
            <!--<strong>Warning!</strong> Better check yourself, you're not looking too good.-->
        </div>
    </div>

    <!-- ** BEGIN SEARCH AREA ** -->
    <div ng-show="uiState.isSearchAreaVisible" class="panel panel-primary">
        <div class="panel-heading"></div>
        <div class="panel-body">
            <div class="form-horizontal">
                <label for="productSearch">Product Search</label>
                <input class="form-control input-sm" id="productSearch"/>
            </div>

        </div>
        <div class="panel-footer">
            <button type="button" id="searchButton" class="btn btn-sm btn-primary" ng-click="searchClick()"><i class="glyphicon glyphicon-search"></i> Search</button>
            <button type="button" id="resetButton" class="btn btn-sm btn-primary" ng-click="cancelClick()"><i class="glyphicon glyphicon-refresh"></i> Reset</button>
            <button type="button" id="addButton" class="btn btn-sm btn-success" ng-click="addClick()"><i class="glyphicon glyphicon-plus"></i> Add</button>
        </div>
    </div>

    <!-- ** BEGIN LIST AREA ** -->
    <div ng-show="uiState.isListAreaVisible" class="table-responsive">
        <table id="productTable" class="table table-bordered table-condensed table-striped">
            <thead>
                <tr>
                    <th>Edit</th>
                    <th>Product Name</th>
                    <th>Introduction Date</th>
                    <th>URL</th>
                    <th>Delete</th>
                </tr>
            </thead>



        </table>
    </div>

    <!-- ** BEGIN DETAIL AREA ** -->
    <div ng-show="uiState.isDetailAreaVisible" class="panel panel-primary">
        
        <div class="panel-heading">
            Product Information
        </div>
        <div class="panel-body">
            <div class="form-group">
                <label for="productname">Product Name</label>
                <input type="text" id="productname" class="form-control"/>
            </div>
            <div class="form-group">
                <label for="introdate">Introduction Date</label>
                <input type="date" id="introdate" class="form-control"/>
            </div>
            <div class="form-group">
                <label for="url">URL</label>
                <input type="url" id="url" class="form-control"/>
            </div>
        </div>
        <input type="hidden" id="productid" value="0"/>
        <div class="panel-footer">
            <div class="row">
                <div class="col-xs-12">
                    <button type="button" id="updateButton" class="btn btn-primary btn-sm" ng-click="saveClick()"><i class="glyphicon glyphicon-floppy-disk"></i>  Add</button>
                    <button type="button" id="cancelButton" class="btn btn-primary btn-sm" ng-click="cancelClick()"><i class="glyphicon glyphicon-remove-circle"></i> Cancel</button>
                </div>
            </div>
        </div>
    </div>



    <!--Page Selection AREA-->
    <div class="row">
        <div class="col-xs-6 text-center">
            <a href="Default.html" class="btn btn-sm btn-info">JQuery Version</a>
        </div>
        <div class="col-xs-6 text-center">
            <a href="Angular.html" class="btn btn-sm btn-danger">Angular Version</a>
        </div>
    </div>
</div>

    <script type="text/javascript">

        // create an angular application scope
        (function () {
            'use strict';

            angular.module('ptcApp', []).controller('PTCController', PTCController);

            function PTCController($scope) {

                var vm = $scope;

                vm.uiState = {};

                // private vars
                const pageMode = {
                    LIST: 'List',
                    EDIT: 'Edit',
                    ADD: 'Add',
                    EXCEPTION: 'Exception',
                    VALIDATION: 'Validation'
                };

 

                function setUIState(state) {

                    // store the state 
                    vm.uiState.mode = state;

                    // do some things based on that state
                    switch (state) {
                        case pageMode.LIST:
                            vm.uiState.isDetailAreaVisible = false;
                            vm.uiState.isListAreaVisible = true;
                            vm.uiState.isSearchAreaVisible = true;
                            vm.uiState.isMessageAreaVisible = false;
                            break;
                        case pageMode.ADD:
                            vm.uiState.isDetailAreaVisible = true;
                            vm.uiState.isListAreaVisible = false;
                            vm.uiState.isSearchAreaVisible = false;
                            vm.uiState.messages = [];
                            break;
                        case pageMode.EDIT:
                            vm.uiState.isDetailAreaVisible = true;
                            vm.uiState.isListAreaVisible = false;
                            vm.uiState.isSearchAreaVisible = false;
                            vm.uiState.messages = [];
                            break;
                        case pageMode.EXCEPTION:
                            vm.uiState.isMessageAreaVisible = true;
                            break;
                        case pageMode.VALIDATION:
                            vm.uiState.isMessageAreaVisible = true;
                            break;
                    }


                }

                // expose the click evetn functions through the Angular $scope
                vm.addClick = addClick;
                vm.cancelClick = cancelClick;
                vm.editClick = editClick;
                vm.deleteClick = deleteClick;
                vm.saveClick = saveClick;

                // CLICK EVENT HANDLERS

               

                function addClick() {
                    setUIState(pageMode.ADD);
                }

                function cancelClick() {
                    setUIState(pageMode.LIST);
                }

                function editClick() {
                    // todo: get data here
                    setUIState(pageMode.EDIT);
                }
                function deleteClick(id) {
                    // todo: delete data here
                }

                function saveClick() {
                    saveData();
                }

                function saveData() {

                    // todo: save data here.
                    // insert or update the data

                    if (vm.uiState.mode === pageMode.ADD) {
                        insertData();
                    }
                    else if (vm.uiState.mode === pageMode.EDIT) {
                        updateData();
                    }

                    if (vm.uiState.mode === pageMode.EXCEPTION || vm.uiState.mode === pageMode.VALIDATION) {
                        // check for validation message
                        setUIState(vm.uiState.mode);
                    } else {
                        // when go back to page, by default display a list
                         setUIState(pageMode.LIST);
                    }

                    
                }



                function insertData() {
                    if (validate()) {
                        
                    }
                }

                function updateData() {
                    if (validate()) {

                    }
                }

                function validate() {
                    // simulate a data validation error
                    vm.uiState.mode = pageMode.VALIDATION;

                    vm.uiState.messages.push({
                        property: 'ProductName',
                        message: 'Product Name must be filled in.'
                    });

                    vm.uiState.messages.push({
                        property: 'Url',
                        message: 'Url must be filled in.'
                    });

                    return false;
                }
                // create a uistate object literal
                function initUIState() {
                    return {
                        mode: pageMode.LIST,
                        isDetailAreaVisible: false,
                        isListAreaVisible: false,
                        isMessageAreaVisible: false,
                        isSearchAreaVisible: false,
                        messages: [] // empty collection
                    };
                }

                function init() {
                    vm.uiState = initUIState(); // first full object injection.
                    setUIState(pageMode.LIST);
                }

               

                init();

               
            }

          
        })();

    </script>
</body>
</html>
